{"version":3,"file":"TouchInput.js","sourceRoot":"","sources":["../../src/inputs/TouchInput.ts"],"names":[],"mappings":"AAEA,MAAM,OAAO,UAAW,SAAQ,WAAW;IACjC,IAAI,CAAO;IACX,WAAW,GAAG,CAAC,CAAC;IAChB,WAAW,GAAG,CAAC,CAAC;IAChB,QAAQ,GAAG,KAAK,CAAC;IAEzB,YAAY,IAAU;QACpB,KAAK,EAAE,CAAC;QACR,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC;QACjB,QAAQ,CAAC,gBAAgB,CAAC,YAAY,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAA;QAClE,QAAQ,CAAC,gBAAgB,CAAC,UAAU,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC;QAC/D,QAAQ,CAAC,gBAAgB,CAAC,WAAW,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC;IACnE,CAAC;IAEO,UAAU,CAAC,CAAa;QAC9B,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;QAC/C,IAAI,CAAC,WAAW,GAAG,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;QAC/C,IAAI,CAAC,QAAQ,GAAG,KAAK,CAAC;IACxB,CAAC;IAEO,QAAQ,CAAC,CAAa;QAC5B,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE;YAClB,IAAI,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAC;YACxC,OAAO;SACR;IACH,CAAC;IAEO,SAAS,CAAC,CAAa;QAC7B,MAAM,SAAS,GAAG,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;QAC9C,MAAM,SAAS,GAAG,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC;QAE9C,MAAM,KAAK,GAAG,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC;QAC3C,MAAM,KAAK,GAAG,SAAS,GAAG,IAAI,CAAC,WAAW,CAAC;QAC3C,MAAM,UAAU,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;QACrD,MAAM,IAAI,GAAG,UAAU,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC;QAExC,IAAI,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,IAAI,CAAC,IAAI,CAAC,SAAS,EAAE;YACxC,OAAO;SACR;QAED,IAAI,CAAC,IAAI,CAAC,QAAQ,IAAI,CAAC,UAAU,IAAI,KAAK,GAAG,CAAC,EAAE;YAC9C,IAAI,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;YAC1C,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;YACrB,OAAO;SACR;QAED,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC;QAErB,IAAI,UAAU,IAAI,KAAK,GAAG,CAAC,EAAE;YAC3B,IAAI,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;SAC3C;QACD,IAAI,UAAU,IAAI,KAAK,GAAG,CAAC,EAAE;YAC3B,IAAI,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,WAAW,CAAC,CAAC,CAAC;SAC5C;QAED,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;QAC7B,IAAI,CAAC,WAAW,GAAG,SAAS,CAAC;IAC/B,CAAC;CACF","sourcesContent":["import { Grid } from '../Grid';\n\nexport class TouchInput extends EventTarget {\n  private grid: Grid;\n  private touchstartX = 0;\n  private touchstartY = 0;\n  private isMoving = false;\n\n  constructor(grid: Grid) {\n    super();\n    this.grid = grid;\n    document.addEventListener('touchstart', (e) => this.touchStart(e))\n    document.addEventListener('touchend', (e) => this.touchEnd(e));\n    document.addEventListener('touchmove', (e) => this.touchMove(e));\n  }\n\n  private touchStart(e: TouchEvent) {\n    this.touchstartX = e.changedTouches[0].screenX;\n    this.touchstartY = e.changedTouches[0].screenY;\n    this.isMoving = false;\n  }\n\n  private touchEnd(e: TouchEvent) {\n    if (!this.isMoving) {\n      this.dispatchEvent(new Event('rotate'));\n      return;\n    }\n  }\n\n  private touchMove(e: TouchEvent) {\n    const touchendX = e.changedTouches[0].screenX;\n    const touchendY = e.changedTouches[0].screenY;\n\n    const xDiff = touchendX - this.touchstartX;\n    const yDiff = touchendY - this.touchstartY;\n    const horisontal = Math.abs(yDiff) < Math.abs(xDiff);\n    const diff = horisontal ? xDiff : yDiff;\n\n    if (Math.abs(diff) < this.grid.blockSize) {\n      return;\n    }\n\n    if (!this.isMoving && !horisontal && yDiff > 0) {\n      this.dispatchEvent(new Event('moveDown'));\n      this.isMoving = true;\n      return;\n    }\n\n    this.isMoving = true;\n\n    if (horisontal && xDiff < 0) {\n      this.dispatchEvent(new Event('moveLeft'));\n    }\n    if (horisontal && xDiff > 0) {\n      this.dispatchEvent(new Event('moveRight'));\n    }\n\n    this.touchstartX = touchendX;\n    this.touchstartY = touchendY;\n  }\n}\n"]}